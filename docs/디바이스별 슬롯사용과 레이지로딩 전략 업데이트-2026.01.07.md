# DeviceCategory별 슬롯 및 로딩 전략 최적화 작업 - 2026.01.07

 - 디바이스별 슬롯사용여부/ 디바이스별 로딩 전략 (Eager/Lazy) 세분화 및 최적화 진행
 - 대상 : `View`, `HOME`, `Section`, `List` 
 - 기존 deviceCategory (smartphone, desktop, tablet으로 구분) 이용
---

## 1. 전역 공통 업데이트 사항

모든 템플릿(`View`, `HOME`, `Section`, `List`)에 공통으로 적용된 아키텍처 변경 사항.

### 1-1. GPT 설정 객체 통합 및 최신화
- 종료 예정인 enableSingleRequest();, disableInitialLoad();을 최신화 하고, 개별 메서드 호출 방식을 GPT 최신 표준인 `googletag.setConfig` 인터페이스로 통합함.

* **변경 전:** `pubads().enableSingleRequest()`, `pubads().disableInitialLoad()` 등 개별 호출
* **변경 후:**
    ```javascript
    googletag.setConfig({
        singleRequest: true,        // SRA(Single Request Architecture) 활성화
        disableInitialLoad: true,   // 초기 로드 방지 (Lazy Load 필수 전제)
        centering: true,            // 크리에이티브 수평 중앙 정렬
        collapseDiv: 'BEFORE_FETCH' // 빈 슬롯 영역 선제적 붕괴 (CLS 방지)
    });
    ```

### 1-2. Lazy Load 로직을 Lazy load 대상이 아닌 리스트 '제외' 패턴으로 변경
기존의 Lazy Load 대상 슬롯을 일일이 나열하던 방식(Whitelist)에서, **즉시 로드(Eager) 슬롯들만 관리하고 나머지는 모두 자동으로 Lazy Load 처리하는 방식(Blacklist)**으로 로직을 반전.

* **목적:** 운영 편의 및 Human Error(누락) 방지
* **구현:**
    * 상수 변경: `LAZY_AD_SLOT_IDS` → **`EAGER_AD_SLOT_IDS`** (즉시 로드 대상 관리)
    * Observer 로직: `!EAGER_AD_SLOT_IDS.includes(id)` 조건으로 Lazy 대상 자동 수집
    * Eager 처리: `googletag.cmd` 초기화 시점에 `EAGER_AD_SLOT_IDS`에 포함된 슬롯은 즉시 `refresh()` 호출
    * 아래 부분에 대한 업데이트를 제외하고 기존, **setupLazyLoading, DOMContentLoaded, IntersectionObserver, ObservingLazySlots 관련 로직** 코딩에는 수정사항 불필요

### 1-3. DeviceCategory(desktop, tablet, smartphone) 에 따라 사용할 광고 슬롯과, 레이지로딩 전략 세분화
, **아래 표 참조**

| page_name | slot_id | deviceCategory별<br>광고 슬롯 사용여부 | Desktop<br>Loading Type | Mobile/Tablet<br>Loading Type | load_type (Key Value) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| View GPT | TC_billboard_X | desktop only | eager | N/A | `eager` |
| View GPT | MR_side_rail_X | desktop only | eager | N/A | `eager` |
| View GPT | BC_byline_rectangle | All | lazy | lazy | `lazy` |
| View GPT | BC_billboard_rectangle | All | lazy | lazy | `lazy` |
| View GPT | BC_native_list_1 | All | eager | lazy | `.setTargeting('load_type', deviceCategory === 'desktop' ? 'eager' : 'lazy')` |
| View GPT | BC_native_list_2 | All | eager | lazy | `.setTargeting('load_type', deviceCategory === 'desktop' ? 'eager' : 'lazy')` |
| View GPT | MC_article_rectangle_1 | All | lazy | lazy | `lazy` |
| View GPT | MC_article_rectangle_2 | All | lazy | lazy | `lazy` |
| View GPT | MC_article_rectangle_3 | All | lazy | lazy | `lazy` |
| View GPT | MC_article_rectangle_4 | All | lazy | lazy | `lazy` |
| View GPT | MC_article_rectangle_5 | All | lazy | lazy | `lazy` |
| View GPT | MC_article_rectangle_6 | All | lazy | lazy | `lazy` |
| View GPT | MC_article_rectangle_7 | All | lazy | lazy | `lazy` |
| View GPT | MC_article_rectangle_8 | All | lazy | lazy | `lazy` |
| HOME GPT | TC_billboard_leaderboard | All | eager | eager | `eager` |
| HOME GPT | MC_billboard_rectangle | All | lazy | lazy | `lazy` |
| HOME GPT | MR_halfpage_rectangle | All | lazy | lazy | `lazy` |
| Setion GPT | TC_billboard_leaderboard | All | eager | eager | `eager` |
| Setion GPT | MR_halfpage_rectangle | All | eager | lazy | `.setTargeting('load_type', deviceCategory === 'desktop' ? 'eager' : 'lazy')` |
| List GPT | TC_billboard_leaderboard | All | eager | eager | `eager` |
| List GPT | MR_halfpage_rectangle | All | eager | lazy | `.setTargeting('load_type', deviceCategory === 'desktop' ? 'eager' : 'lazy')` |

---

## 2. 페이지별 상세 업데이트 내역

### 2-1. View GPT (기사 본문)
* **`TC_billboard_X` (상단 빌보드)**
    * **Load Strategy:** **Eager Load** (즉시 노출)
    *데스크탑외 미노출(유지)* 

* **`MR_side_rail_X` (우측 레일)**
    * **Load Strategy:** 기존 Lazy에서 **`EAGER_AD_SLOT_IDS`**에 추가.
    * **KeyValue : load_type: 'eager'**로 변경
    *데스크탑외 미노출(유지)* 

* **`BC_native_list_1` / `BC_native_list_2` (우측 리스트 내 네이티브)**
    * **Device Policy:** 기존 Mobile/Tablet 전용에서 **All Devices(Desktop 포함, 모든 디바이스에서 나오도록)**로 변경.
    * **Load Strategy:**
        * **Desktop 에서:** Eager Load (리스트 노출 시점 고려)
        * **Mobile/Tablet 에서:** Lazy Load (스크롤 하단 위치 고려)
        * **Targeting:** `load_type` 키 값을 디바이스에 따라 `'eager'` 또는 `'lazy'`로 동적 할당(아래와 같이).
    **.setTargeting('load_type', deviceCategory === 'desktop' ? 'eager' : 'lazy')**

### 2-2. HOME GPT (메인)
* **`TC_billboard_leaderboard` (상단 빌보드)**
    * **Load Strategy:** **Eager Load** (All Devices 노출 유지).

* **`MR_halfpage_rectangle` (우측 레일)**
    * **Load Strategy:** **Lazy Load** (All Devices) 현재상태 유지.    

* **`MC_billboard_rectangle` (중단 배너)**
    * **Load Strategy:** **Lazy Load** (All Devices) 현재상태 유지.

### 2-3. Section GPT (섹션 프론트) & List GPT (리스트)
두 템플릿은 동일한 로직과 정책이 적용합니다.

* **`TC_billboard_leaderboard` (상단 빌보드)**
    * **Load Strategy:** **Eager Load** (All Devices).

* **`MR_halfpage_rectangle` (우측 레일)**
    * **Load Strategy (Hybrid):** 디바이스별 로딩 전략 이원화
        * **Desktop에서는:** **Eager Load** (초기 화면 노출 가능성 높음)
        * **Mobile/Tablet 에서:** **Lazy Load** (반응형, 하단으로 레이아웃 변경됨에 따른 최적화)
    * **Logic Implementation:**
        * `isDesktop` 판별 로직을 통해 `EAGER_AD_SLOT_IDS` 배열에 동적으로 추가.
        * `.setTargeting('load_type', ...)` 값을 디바이스 환경에 맞춰 분기 처리하여 리포트 정합성 확보.
        **.setTargeting('load_type', deviceCategory === 'desktop' ? 'eager' : 'lazy')**
---

